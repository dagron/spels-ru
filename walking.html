<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
   "http://www.w3.org/TR/html4/strict.dtd"> 
 <html> 
  <head> 
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> 
    <link href="css/style.css" type="text/css" rel="stylesheet"> 
    <link href="css/prettify.css" type="text/css" rel="stylesheet"> 
    <script type="text/javascript" src="js/prettify.js"></script> 
    <script type="text/javascript" src="js/lang-clojure.js"></script> 
    <title>Casting SPELs with Clojure: Walking Around in our World</title> 
  </head> 
  <body onLoad="prettyPrint()"> 
    <div class="main"> 
      <div class="top"> 
        <span class="pager"><a href="casting.html">&lt;&lt; начало</a></span> 
        <span class="pager"><a href="looking.html">&lt; назад</a></span> 
        <span class="pager"><a href="casting.html">1</a></span> 
        <span class="pager"><a href="syntax.html">2</a></span> 
        <span class="pager"><a href="data.html">3</a></span> 
        <span class="pager"><a href="looking.html">4</a></span> 
        <span class="pager current">5</span> 
        <span class="pager"><a href="spels.html">6</a></span> 
        <span class="pager"><a href="actions.html">7</a></span> 
        <span class="pager"><a href="addendum.html">8</a></span> 
        <span class="pager"><a href="no_macros.html">9</a></span> 
        <span class="pager"><a href="spels.html">вперед &gt;</a></span> 
        <span class="pager"><a href="no_macros.html">конец &gt;&gt;</a></span> 
        <span class="pagertext">Походим вокруг...</span> 
      </div> 
      <div class="heading">Побродим вокруг в нашем мире</div> 
      <div class="textblock"> 
        <p> Хорошо, теперь когда мы можем видеть наш мир, давайте напишем немного кода, который позволит нам в нем
        перемещаться. Функция <code>walk-direction</code> (не <i>функциональном стиле</i>) принимает направление и
        позволяет нам идти туда:
        </p> 
        <pre class="prettyprint lang-clojure"> 
(defn walk-direction [direction]
  (let [next (first (filter (fn [x] (= direction (first x)))
                            (rest (location game-map))))]
    (cond next (do (def location (nth next 2)) (look))
          :else '(you cannot go that way -))))</pre> 
        <p> Специальная команда <code>let</code> позволяет нам создать локальную переменную <code>next</code>, которая
        будет содержать описание пути для направления, в котором игрок хочет пойти - <code>rest</code> просто обрубает
        первый элемент списка. Если пользоватль введет несуществующее направление, то значение
        переменной <code>next</code> будет <code>()</code>. Команда <code>cond</code> это как последовательность команд
        если-то (if-then) в Lisp: каждый ряд в cond содержит значение на проверку и действие на выполнение. В этом
        случае, если <i>next location</i> не nil, то будет вызвана команда <code>def</code>, которая переопределит
        месторасположение игрока на третий элемент (тот, который находится под индексом 2) в описании пути, который
        является символом, описывающий новое направление, а затем позволит пользователю посмотреть на новое место. Если
        значение переменной <code>next</code> является <code>nil</code>, то он проваливается вниз к следующей линии и
        предостерегает пользователя. Давайте это попробуем:
        </p> 
        <pre class="prettyprint lang-clojure"> 
(walk-direction 'west)</pre> 
        <pre class="console"> 
user=> (walk-direction 'west)
(you are in a beautiful garden -
there is a well in front of you -
there is a door going east from here -
you see a frog on the floor -
you see a chain on the floor -)
        </pre> 
      <div class="note"> 
        <p> 
          <img src="images/wizard-small.png" style="margin-right:15px; float: left" alt="Маленький Волшебник"> В
               Clojure, <code>nil</code> и пустой список ("()") не то же самое, в отличии от Common Lisp.
        </p> 
      </div> 
      <p>&nbsp;</p> 
        <p> После того, как мы смогли упростить наши описывающие функции создав команду <code>look</code>, игроку проще
          печатать. Подобных образом мы можем подогнать команду <code>walk-direction</code>, чтобы не нужно было
          печатать раздражающую одинарную кавычку. То, как мы уже узнали, когда компилятор читает форму в <b>Режиме
          Кода</b>, он читает все ее параметры тоже в <b>Режиме Кода</b>, только если мы не используем одинарную кавычку
          чтобы сообщить что так делать не надо. Есть ли какой-то способ, как мы сможем сказать компилятору,
          что <code>west</code> это просто данные, не прибегая к кавычке?
        </p> 
      </div> 
      <hr> 
      <div class="bottom"> 
        <span class="pager"><a href="casting.html">&lt;&lt; начало</a></span> 
        <span class="pager"><a href="looking.html">&lt; назад</a></span> 
        <span class="pager"><a href="casting.html">1</a></span> 
        <span class="pager"><a href="syntax.html">2</a></span> 
        <span class="pager"><a href="data.html">3</a></span> 
        <span class="pager"><a href="looking.html">4</a></span> 
        <span class="pager current">5</span> 
        <span class="pager"><a href="spels.html">6</a></span> 
        <span class="pager"><a href="actions.html">7</a></span> 
        <span class="pager"><a href="addendum.html">8</a></span> 
        <span class="pager"><a href="no_macros.html">9</a></span> 
        <span class="pager"><a href="spels.html">вперед &gt;</a></span> 
        <span class="pager"><a href="no_macros.html">конец &gt;&gt;</a></span> 
        <span class="pagertext">Походим вокруг...</span> 
      </div> 
  </div> 
 </body> 
</html> 
